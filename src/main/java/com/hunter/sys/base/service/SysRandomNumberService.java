package com.hunter.sys.base.service;import com.hunter.common.constant.BaseConstant;import com.hunter.sys.base.dao.SysRandomNumberDao;import com.hunter.sys.base.entity.SysRandomNumber;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service;import java.util.Date;import java.util.Random;/** * @Author zhangcl * @Date 17/3/8  下午11:42 */@Servicepublic class SysRandomNumberService {    @Autowired    SysRandomNumberDao randomNumberDao;    /**     * 获取库中的一个有效的随机数     *     * @return     */    public long getRandomNumber() {        //随机获取一个值        Long validNumberCount = randomNumberDao.countBySql("countValidNumber", null);        Random random = new Random();        int index = random.nextInt(validNumberCount.intValue());        SysRandomNumber validSysRandomNumber = randomNumberDao.findOneById(index);        if (null == validSysRandomNumber) {            throw new RuntimeException("根据" + index + "没有找到对应的sysRandomNumber实体");        }        SysRandomNumber inValidSysRandomNumber = randomNumberDao.findOneById(validNumberCount);        int temp = validSysRandomNumber.getNumber();        validSysRandomNumber.setNumber(inValidSysRandomNumber.getNumber());        validSysRandomNumber.setModifyTime(new Date());        inValidSysRandomNumber.setNumber(temp);        inValidSysRandomNumber.setNumberIsUsed(BaseConstant.INT_1);        inValidSysRandomNumber.setModifyTime(new Date());        randomNumberDao.updateByEntity(inValidSysRandomNumber);        randomNumberDao.updateByEntity(validSysRandomNumber);        return temp;    }}