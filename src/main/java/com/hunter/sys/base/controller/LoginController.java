package com.hunter.sys.base.controller;import com.google.common.base.Strings;import com.hunter.base.vo.ApiResponseVo;import com.hunter.common.util.EncryptUtil;import com.hunter.common.util.UserUtil;import com.hunter.sys.base.entity.SysMenu;import com.hunter.sys.base.entity.SysUser;import com.hunter.sys.base.service.SysMenuService;import com.hunter.sys.base.service.SysUserService;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.ModelMap;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.ResponseBody;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpSession;import java.util.List;import static com.hunter.common.constant.ErrorCodeEnum.PARAM_REQUIRED;/** * Created by zhangchaolong on 16/6/16. */@Controller@RequestMapping("/sys/login")public class LoginController {    @Autowired    private SysMenuService sysMenuService;    @Autowired    private SysUserService sysUserService;    /**     * 登录     *     * @param request     * @param modelMap     * @return     * @throws Exception     */    @RequestMapping("/login")    public String login(HttpServletRequest request, ModelMap modelMap)            throws Exception {        SysUser sysUser = UserUtil.getCurrentUser();        modelMap.put("user", sysUser);        //获取菜单        List<SysMenu> sysMenuList = sysMenuService.getAllMenu();        modelMap.put("menuList", sysMenuList);        return "/login/main";    }    /**     * 登录     *     * @param request     * @param modelMap     * @return     * @throws Exception     */    @RequestMapping(value = "/ajax/login",            produces = "application/json;charset=UTF-8")    @ResponseBody    public String ajaxLogin(HttpServletRequest request, ModelMap modelMap) {        String username = request.getParameter("username");        String pwd = request.getParameter("password");        if (Strings.isNullOrEmpty(username)) {            return ApiResponseVo.error(PARAM_REQUIRED.getCode(), "用户名不能为空");        }        if (Strings.isNullOrEmpty(pwd)) {            return ApiResponseVo.error(PARAM_REQUIRED.getCode(), "密码不能为空");        }        String encryptPwd = EncryptUtil.encodeByMD5(pwd);        SysUser user = null;        //验证密码        try {            user = sysUserService.findUserByCode(username, encryptPwd);        } catch (Exception e) {            return ApiResponseVo.error(PARAM_REQUIRED.getCode(), "用户名或密码不正确");        }        if (user == null) {            return ApiResponseVo.error(PARAM_REQUIRED.getCode(), "用户名或密码不正确");        }        HttpSession session = request.getSession();        //放到session中        session.setAttribute("user", user);        return ApiResponseVo.success(null);    }    /**     * 获取首页     *     * @param request     * @param modelMap     * @return     * @throws Exception     */    @RequestMapping("/getHomePage")    public String getHomePage(HttpServletRequest request, ModelMap modelMap)            throws Exception {        return "/login/homePage";    }}